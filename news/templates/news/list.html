{% extends 'base.html' %}
{% load static %}
{% block content %}

<section class="px-6 md:px-16 py-12 bg-[--color-brand-light] text-[--color-font-main]">
  <div class="max-w-7xl mx-auto">
    <!-- Page Heading -->
    <header class="mb-12 text-center">
      <h1 class="text-3xl font-bold text-[--color-brand-primary] mb-4">News · Articles · Blog Posts</h1>
      <p class="max-w-2xl mx-auto leading-relaxed">
        Industry news, informative articles, and informal posts — all focused on digital marketing, AI, and online growth.
      </p>
    </header>

    <!-- Category Filter -->
    {% if categories %}
    <div class="flex flex-wrap justify-center gap-3 mb-12">
      {% for category in categories %}
        <a href="{{ category.get_absolute_url }}"
           class="px-4 py-2 rounded-full border border-[--color-brand-accent] text-[--color-brand-primary] hover:bg-[--color-brand-primary] hover:text-white transition {% if current_category and current_category.id == category.id %}bg-[--color-brand-primary] text-white{% endif %}">
          {{ category.name }}
        </a>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Featured Blog Posts -->
    {% if featured_posts %}
    <section class="mb-16">
      <h2 class="text-2xl font-semibold text-[--color-brand-primary] mb-8 text-center">Featured Articles</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in featured_posts|slice:"0:6" %}
        <article class="bg-white border border-[--color-brand-accent]/30 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition flex flex-col">
          <a href="{{ post.get_absolute_url }}">
            {% if post.external_image_url %}
              <img src="{{ post.external_image_url }}" alt="{{ post.title }}" class="w-full h-56 object-cover">
            {% elif post.get_image_url %}
              <img src="{{ post.get_image_url }}" alt="{{ post.title }}" class="w-full h-56 object-cover">
            {% elif post.youtube_url %}
              <img src="https://img.youtube.com/vi/{{ post.get_youtube_video_id }}/maxresdefault.jpg"
                   alt="{{ post.title }}" class="w-full h-56 object-cover"
                   onerror="this.onerror=null; this.src='https://img.youtube.com/vi/{{ post.get_youtube_video_id }}/hqdefault.jpg';">
            {% endif %}
          </a>
          <div class="p-6 flex flex-col flex-grow">
            <h3 class="text-lg font-bold text-[--color-brand-primary] mb-2">{{ post.title }}</h3>
            <p class="flex-grow text-[--color-font-main]/80 mb-4">{{ post.content|striptags|truncatewords:25 }}</p>
            <a href="{{ post.get_absolute_url }}" class="text-[--color-brand-secondary] hover:text-[--color-brand-accent] font-semibold mt-auto transition">
              Read More →
            </a>
          </div>
        </article>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Regular Blog Posts -->
    {% if posts %}
    <section>
      <h2 class="text-2xl font-semibold text-[--color-brand-primary] mb-8 text-center">Latest Articles</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in posts %}
        <article class="bg-white border border-[--color-brand-accent]/30 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition flex flex-col">
          <a href="{{ post.get_absolute_url }}">
            {% if post.external_image_url %}
              <img src="{{ post.external_image_url }}" alt="{{ post.title }}" class="w-full h-56 object-cover">
            {% elif post.get_image_url %}
              <img src="{{ post.get_image_url }}" alt="{{ post.title }}" class="w-full h-56 object-cover">
            {% elif post.youtube_url %}
              <img src="https://img.youtube.com/vi/{{ post.get_youtube_video_id }}/maxresdefault.jpg"
                   alt="{{ post.title }}" class="w-full h-56 object-cover"
                   onerror="this.onerror=null; this.src='https://img.youtube.com/vi/{{ post.get_youtube_video_id }}/hqdefault.jpg';">
            {% endif %}
          </a>
          <div class="p-6 flex flex-col flex-grow">
            <h3 class="text-lg font-bold text-[--color-brand-primary] mb-2">{{ post.title }}</h3>
            <p class="flex-grow text-[--color-font-main]/80 mb-4">{{ post.content|striptags|truncatewords:25 }}</p>
            <a href="{{ post.get_absolute_url }}" class="text-[--color-brand-secondary] hover:text-[--color-brand-accent] font-semibold mt-auto transition">
              Read More →
            </a>
          </div>
        </article>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if posts.has_other_pages %}
      <div class="flex justify-center items-center gap-2 mt-12 flex-wrap">
        {% if posts.has_previous %}
          <a href="?page={{ posts.previous_page_number }}" class="px-4 py-2 border border-[--color-brand-primary] text-[--color-brand-primary] rounded hover:bg-[--color-brand-primary] hover:text-white transition">Previous</a>
        {% endif %}

        {% for i in posts.paginator.page_range %}
          {% if posts.number == i %}
            <span class="px-4 py-2 bg-[--color-brand-primary] text-white border border-[--color-brand-primary] rounded">{{ i }}</span>
          {% else %}
            <a href="?page={{ i }}" class="px-4 py-2 border border-[--color-brand-primary] text-[--color-brand-primary] rounded hover:bg-[--color-brand-primary] hover:text-white transition">{{ i }}</a>
          {% endif %}
        {% endfor %}

        {% if posts.has_next %}
          <a href="?page={{ posts.next_page_number }}" class="px-4 py-2 border border-[--color-brand-primary] text-[--color-brand-primary] rounded hover:bg-[--color-brand-primary] hover:text-white transition">Next</a>
        {% endif %}
      </div>
      {% endif %}
    </section>
    {% else %}
      <div class="text-center py-16 bg-white rounded-lg mt-12">
        <h2 class="text-2xl font-bold mb-4">No Articles Found</h2>
        <p class="text-[--color-font-main]/70">Check back soon for new content!</p>
      </div>
    {% endif %}
  </div>
</section>

{% endblock %}
