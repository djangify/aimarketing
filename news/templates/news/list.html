{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="px-6 md:px-16 py-12 bg-[color:var(--color-brand-light)] text-[color:var(--color-font-main)]">
  <div class="max-w-7xl mx-auto">

    <!-- Page Heading -->
    <header class="text-center mb-12 space-y-4">
      <h1 class="text-3xl font-bold text-[color:var(--color-brand-primary)]">The AI Marketing Platform Shop</h1>
      <p class="max-w-2xl mx-auto leading-relaxed">
        Practical guides and toolkits to support your local and online business.
      </p>
    </header>

    <!-- Search Bar -->
    <form method="get" action="." class="flex flex-col sm:flex-row justify-center gap-3 max-w-md mx-auto mb-12">
      <label for="search" class="sr-only">Search products</label>
      <input
        type="text"
        name="q"
        id="search"
        placeholder="Search guides and services..."
        value="{{ request.GET.q }}"
        class="w-full border border-[color:var(--color-brand-accent)] rounded-lg px-4 py-2 focus:outline-none focus:border-[color:var(--color-brand-primary)]"
      />
      <button
        type="submit"
        class="px-6 py-2 bg-[color:var(--color-brand-primary)] text-white font-semibold rounded-lg hover:bg-[color:var(--color-brand-secondary)] transition"
      >
        Search
      </button>
    </form>

    <!-- Category Filter -->
    {% if categories %}
    <div class="flex flex-wrap justify-center gap-3 mb-12">
      <a href="{% url 'shop:product_list' %}"
         class="px-5 py-2 rounded-full border border-[color:var(--color-brand-accent)] text-[color:var(--color-brand-primary)] hover:bg-[color:var(--color-brand-primary)] hover:text-white transition {% if not current_category %}bg-[color:var(--color-brand-primary)] text-white{% endif %}">
        All Products
      </a>
      {% for category in categories %}
        <a href="{{ category.get_absolute_url }}"
           class="px-5 py-2 rounded-full border border-[color:var(--color-brand-accent)] text-[color:var(--color-brand-primary)] hover:bg-[color:var(--color-brand-primary)] hover:text-white transition {% if current_category and current_category.id == category.id %}bg-[color:var(--color-brand-primary)] text-white{% endif %}">
          {{ category.name }}
        </a>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Product Grid -->
    {% if products %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {% for product in products %}
      <article class="bg-white border border-[color:var(--color-brand-accent)]/30 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition flex flex-col">
        <a href="{{ product.get_absolute_url }}">
          {% if product.get_image_url %}
            <img src="{{ product.get_image_url }}" alt="{{ product.title }}" class="w-full h-80 object-contain bg-[color:var(--color-brand-light)]">
          {% else %}
            <div class="w-full h-80 flex items-center justify-center bg-[color:var(--color-brand-light)] text-[color:var(--color-brand-accent)]">
              No Image Available
            </div>
          {% endif %}
        </a>

        <div class="p-6 flex flex-col flex-grow">
          <h2 class="text-lg font-semibold text-[color:var(--color-brand-primary)] mb-2">
            <a href="{{ product.get_absolute_url }}">{{ product.title }}</a>
          </h2>
          <p class="flex-grow text-[color:var(--color-font-main)]/80 mb-4">
            {{ product.description|striptags|truncatewords:26 }}
          </p>

          <div class="flex items-center justify-between mt-auto">
            <span class="text-lg font-bold text-[color:var(--color-font-main)]">
              Â£{{ product.current_price|floatformat:2 }}
            </span>
            <div class="flex items-center text-yellow-500 space-x-1">
              {% if product.average_rating %}
                {% for i in "12345"|make_list %}
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 15l-5.878 3.09 1.123-6.545L.49 6.91l6.562-.954L10 0l2.948 5.956 6.562.954-4.755 4.635 1.123 6.545z"
                      {% if forloop.counter <= product.average_rating %}
                        class="fill-current"
                      {% else %}
                        class="text-[color:var(--color-brand-accent)]/30"
                      {% endif %}></path>
                  </svg>
                {% endfor %}
                <span class="text-sm text-[color:var(--color-font-main)]/70">({{ product.reviews.count }})</span>
              {% else %}
                <div class="h-5"></div>
              {% endif %}
            </div>
          </div>
        </div>
      </article>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if products.has_other_pages %}
    <div class="flex justify-center items-center gap-2 mt-12 flex-wrap">
      {% if products.has_previous %}
        <a href="?page={{ products.previous_page_number }}" class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">Previous</a>
      {% endif %}

      {% for num in products.paginator.page_range %}
        {% if products.number == num %}
          <span class="px-4 py-2 bg-[color:var(--color-brand-primary)] text-white border border-[color:var(--color-brand-primary)] rounded">{{ num }}</span>
        {% else %}
          <a href="?page={{ num }}" class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if products.has_next %}
        <a href="?page={{ products.next_page_number }}" class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">Next</a>
      {% endif %}
    </div>
    {% endif %}
    {% else %}
    <div class="text-center py-16 bg-white rounded-lg mt-12">
      <h2 class="text-2xl font-bold mb-4 text-[color:var(--color-brand-primary)]">No Products Found</h2>
      <p class="text-[color:var(--color-font-main)]/70">Check back soon for new content!</p>
    </div>
    {% endif %}
  </div>
</section>
{% endblock %}
